<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Creating Vagrant Base boxes | J&#39;aime pas les piles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Create a VM inside VirtualBox No usb No audio One dynamic disk (10GiB) 512 MiB of RAM One vcpu One network card in NAT mode  Install the base system, as minimal as possibleScientific Linux 5 Retrieve">
<meta property="og:type" content="article">
<meta property="og:title" content="Creating Vagrant Base boxes">
<meta property="og:url" content="http://blog.bapt.name/2014/01/17/creating-vagrant-base-boxes/index.html">
<meta property="og:site_name" content="J&#39;aime pas les piles">
<meta property="og:description" content="Create a VM inside VirtualBox No usb No audio One dynamic disk (10GiB) 512 MiB of RAM One vcpu One network card in NAT mode  Install the base system, as minimal as possibleScientific Linux 5 Retrieve">
<meta property="og:updated_time" content="2017-10-09T01:02:42.819Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Creating Vagrant Base boxes">
<meta name="twitter:description" content="Create a VM inside VirtualBox No usb No audio One dynamic disk (10GiB) 512 MiB of RAM One vcpu One network card in NAT mode  Install the base system, as minimal as possibleScientific Linux 5 Retrieve">
  
    <link rel="alternate" href="/atom.xml" title="J&#39;aime pas les piles" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">J&#39;aime pas les piles</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">My lost place</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.bapt.name"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-creating-vagrant-base-boxes" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/01/17/creating-vagrant-base-boxes/" class="article-date">
  <time datetime="2014-01-17T09:34:56.000Z" itemprop="datePublished">2014-01-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/vagrant-box-sl-virtualbox-devops-sysadmin/">vagrant box sl virtualbox devops sysadmin</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Creating Vagrant Base boxes
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Create-a-VM-inside-VirtualBox"><a href="#Create-a-VM-inside-VirtualBox" class="headerlink" title="Create a VM inside VirtualBox"></a>Create a VM inside VirtualBox</h2><ul>
<li>No usb</li>
<li>No audio</li>
<li>One dynamic disk (10GiB)</li>
<li>512 MiB of RAM</li>
<li>One vcpu</li>
<li>One network card in NAT mode</li>
</ul>
<h2 id="Install-the-base-system-as-minimal-as-possible"><a href="#Install-the-base-system-as-minimal-as-possible" class="headerlink" title="Install the base system, as minimal as possible"></a>Install the base system, as minimal as possible</h2><h3 id="Scientific-Linux-5"><a href="#Scientific-Linux-5" class="headerlink" title="Scientific Linux 5"></a>Scientific Linux 5</h3><ul>
<li>Retrieve ISOs CD 1 and 2</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://ftp1.scientificlinux.org/linux/scientific/5x/iso/x86_64/<span class="built_in">cd</span>/SL.510.110513.CD.x86_64.disc&#123;1,2&#125;.iso</div></pre></td></tr></table></figure>
<ul>
<li>Boot CD</li>
<li>Use basic video driver installation</li>
<li>Use default configuration<ul>
<li>except:<ul>
<li>DHCP for ipv6</li>
<li>Deselct every packages sets</li>
</ul>
</li>
</ul>
</li>
<li>Use vagrant as root password</li>
</ul>
<h3 id="Scientific-Linux-6"><a href="#Scientific-Linux-6" class="headerlink" title="Scientific Linux 6"></a>Scientific Linux 6</h3><ul>
<li>Retrieve netinstall ISO CD</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://ftp.scientificlinux.org/linux/scientific/6x/x86_64/iso/SL-64-x86_64-2013-03-18-boot.iso</div></pre></td></tr></table></figure>
<ul>
<li>Boot CD</li>
<li>Use network install URL:</li>
<li>Use default configuration</li>
<li>Use vagrant as root password</li>
</ul>
<p>Debian 7: retrieve netinstall ISO CD</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget http://cdimage.debian.org/debian-cd/7.3.0/amd64/iso-cd/debian-7.3.0-amd64-netinst.iso</div></pre></td></tr></table></figure>
<h2 id="System-configuration"><a href="#System-configuration" class="headerlink" title="System configuration"></a>System configuration</h2><h3 id="Scientific-Linux-5-6"><a href="#Scientific-Linux-5-6" class="headerlink" title="Scientific Linux 5/6"></a>Scientific Linux 5/6</h3><ul>
<li>Update system and reboot if kernel was updated</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum clean all &amp;&amp; yum update -y</div><div class="line">reboot</div></pre></td></tr></table></figure>
<ul>
<li>Add a vagrant user with vagrant as password</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">adduser vagrant</div><div class="line">passd vagrant</div></pre></td></tr></table></figure>
<ul>
<li>Configure password-less sudo for vagrant user</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">visudo</div><div class="line">Default:vagrant !requiretty</div><div class="line">vagrant ALL=(ALL) NOPASSWD: ALL</div></pre></td></tr></table></figure>
<ul>
<li>Configure ssh server</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sed -i <span class="string">'s/^#UseDNS yes/UseDNS no/'</span> /etc/ssh/sshd_config</div></pre></td></tr></table></figure>
<ul>
<li>Configure ssh authorized_keys for vagrant user</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mkdir ~vagrant/.ssh</div><div class="line">curl -o ~/vagrant/.ssh/authorized_keys \</div><div class="line">  https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub</div><div class="line">chmod 0700 ~vagrant/.ssh</div><div class="line">chmod 0600 ~vagrant/.ssh/authorized_keys</div><div class="line">chown -R vagrant:vagrant ~vagrant/.ssh</div></pre></td></tr></table></figure>
<h3 id="Scientific-Linux-6-1"><a href="#Scientific-Linux-6-1" class="headerlink" title="Scientific Linux 6"></a>Scientific Linux 6</h3><p>Minimal SL6 install does not install acpid nor perl</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install -y acpid perl</div><div class="line">service acpid start</div></pre></td></tr></table></figure>
<h2 id="VirtualBox-Additions-installation"><a href="#VirtualBox-Additions-installation" class="headerlink" title="VirtualBox Additions installation"></a>VirtualBox Additions installation</h2><h3 id="Scientific-Linux-5-6-1"><a href="#Scientific-Linux-5-6-1" class="headerlink" title="Scientific Linux 5/6"></a>Scientific Linux 5/6</h3><ul>
<li>Insert Guest additions CD image using VirtualBox device menu</li>
<li>Install required software for build the VirtualBox additions</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y gcc make kernel-devel</div></pre></td></tr></table></figure>
<ul>
<li>Build and install VirtualBox additions</li>
</ul>
<p>Error about OpenGL or Window System drivers are “normal”.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mount /dev/cdrom /mnt</div><div class="line">sh /mnt/VBoxLinuxAdditions.run</div><div class="line">umount /mnt</div></pre></td></tr></table></figure>
<h2 id="Cleaning-image"><a href="#Cleaning-image" class="headerlink" title="Cleaning image"></a>Cleaning image</h2><h3 id="Scientific-Linux-5-6-2"><a href="#Scientific-Linux-5-6-2" class="headerlink" title="Scientific Linux 5/6"></a>Scientific Linux 5/6</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">yum clean all</div><div class="line">: &gt; /var/<span class="built_in">log</span>/messages</div><div class="line">: &gt; /var/<span class="built_in">log</span>/secure</div><div class="line">: &gt; ~/.bash_history</div><div class="line"><span class="built_in">kill</span> -9 $$</div></pre></td></tr></table></figure>
<p>ACPI shutdown VM using VirtualBox Machine menu.</p>
<h2 id="Packing-the-boxes"><a href="#Packing-the-boxes" class="headerlink" title="Packing the boxes"></a>Packing the boxes</h2><h3 id="Scientific-Linux-5-1"><a href="#Scientific-Linux-5-1" class="headerlink" title="Scientific Linux 5"></a>Scientific Linux 5</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vagrant package --output sl5-64-VB436-nocm.box --base scientificlinux5</div><div class="line">vagrant package --output sl6-64-VB436-nocm.box --base scientificlinux6</div></pre></td></tr></table></figure>
<h2 id="Testing-the-boxes"><a href="#Testing-the-boxes" class="headerlink" title="Testing the boxes"></a>Testing the boxes</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">vagrant box add sl5-64-nocm sl5-64-VB436-nocm.box</div><div class="line">vagrant box add sl6-64-nocm sl6-64-VB436-nocm.box</div></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mkdir ~/sl5-64-nocm-tests &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></div><div class="line">vagrant init sl5-64-nocm</div><div class="line">vagrant up</div><div class="line">vagrant ssh</div><div class="line">ping -c 3 gnu.org</div><div class="line">sudo -s</div><div class="line"><span class="built_in">exit</span></div><div class="line"><span class="built_in">exit</span></div><div class="line">vagrant destroy -f</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line">rm -rf ~/sl5-64-nocm-tests</div></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">mkdir ~/sl6-64-nocm-tests &amp;&amp; <span class="built_in">cd</span> <span class="variable">$_</span></div><div class="line">vagrant init sl6-64-nocm</div><div class="line">vagrant up</div><div class="line">vagrant ssh</div><div class="line">ping -c 3 gnu.org</div><div class="line">sudo -s</div><div class="line"><span class="built_in">exit</span></div><div class="line"><span class="built_in">exit</span></div><div class="line">vagrant destroy -f</div><div class="line"><span class="built_in">cd</span> ..</div><div class="line">rm -rf ~/sl6-64-nocm-tests</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.bapt.name/2014/01/17/creating-vagrant-base-boxes/" data-id="cj8jh5zuf0005ujmdj2if31om" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/01/18/mail-server-migration/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Récent</strong>
      <div class="article-nav-title">
        
          Mail server migration
        
      </div>
    </a>
  
  
    <a href="/2013/12/11/node-less-puppet-setup-using-hiera/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Ancien</strong>
      <div class="article-nav-title">Node-less puppet setup using hiera</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Catégories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/archlinux-sysadmin-packaing/">archlinux sysadmin packaing</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/devops-sysadmin-puppet/">devops sysadmin puppet</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/grid-dev-sysadmin-python/">grid dev sysadmin python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/puppet-hiera-sysadmin/">puppet hiera sysadmin</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/puppet-sysadmin-vagrant/">puppet sysadmin vagrant</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vagrant-box-sl-virtualbox-devops-sysadmin/">vagrant box sl virtualbox devops sysadmin</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/xen-sysadmin/">xen sysadmin</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/12/">December 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/10/09/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2014/07/29/rebuilding-a-package-using-abs/">Rebuilding a package using ABS</a>
          </li>
        
          <li>
            <a href="/2014/07/28/grid-scripting-in-python/">Grid scripting in python</a>
          </li>
        
          <li>
            <a href="/2014/04/18/xenserver-installation-using-http-source/">XenServer installation using http source.</a>
          </li>
        
          <li>
            <a href="/2014/04/10/regenerating-puppet-certificates/">Regenerating puppet certificates.</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Baptiste Grenier<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>